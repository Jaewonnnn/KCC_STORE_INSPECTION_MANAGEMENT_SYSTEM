<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sims.master.product_manage.mapper.ProductMapper">
    <resultMap id="selectProductInfo" type="com.sims.master.product_manage.vo.ProductResponse">
        <id property="pdtId" column="PDT_ID"/>
        <result property="brandNm" column="brandNm"/>
        <result property="pdtNm" column="PDT_NM"/>
        <result property="pdtPrice" column="PDT_PRICE"/>
        <result property="expDaynum" column="EXP_DAYNUM"/>
        <result property="pdtSellSttsNm" column="pdtSellSttsNm"/>
    </resultMap>
    <select id="selectAllProducts" resultMap="selectProductInfo" parameterType="com.sims.master.product_manage.vo.ProductRequest">
        SELECT
            PDT_ID
          , BRAND_CD.DTL_CD_NM AS brandNm
          , PDT_NM
          , PDT_PRICE
          , EXP_DAYNUM
          , PDT_SELL_STTS_CD.DTL_CD_NM AS pdtSellSttsNm
        FROM
            PDT
        LEFT JOIN COMM_CD_DTL BRAND_CD
            ON BRAND_CD.DTL_CD = PDT.BRAND_CD
        LEFT JOIN COMM_CD_DTL PDT_SELL_STTS_CD
            ON PDT_SELL_STTS_CD.DTL_CD = PDT.PDT_SELL_STTS_CD
        <where>
            <if test="@org.apache.commons.lang3.StringUtils@isNotEmpty(brandNm)">
                AND BRAND_CD.DTL_CD = (SELECT DTL_CD FROM COMM_CD_DTL WHERE DTL_CD_NM = #{brandNm})
            </if>
            <if test="@org.apache.commons.lang3.StringUtils@isNotEmpty(pdtNm)">
                AND PDT_NM = #{pdtNm}
            </if>
            <if test="@org.apache.commons.lang3.StringUtils@isNotEmpty(pdtSellSttsNm)">
                AND PDT_SELL_STTS_CD.DTL_CD = (SELECT DTL_CD FROM COMM_CD_DTL WHERE DTL_CD_NM = #{pdtSellSttsNm})
            </if>
        </where>
        ORDER BY
            PDT_ID
    </select>

    <select id="selectAllPdtNm" resultType="String">
        SELECT
            PDT_NM
        FROM
            PDT
    </select>

    <select id="selectAllBrandNm" resultType="String">
        SELECT
            DTL_CD_NM
        FROM
            COMM_CD_DTL CCD
        INNER JOIN COMM_CD CC
            ON CCD.COMM_CD_ID = CC.COMM_CD_ID
        WHERE
            COMM_CD ='BRAND_CD'
        ORDER BY
            DTL_CD
    </select>

    <select id="selectAllPdtSellSttsNm" resultType="String">
        SELECT
            DTL_CD_NM
        FROM
            COMM_CD_DTL CC
        INNER JOIN COMM_CD CD
            ON CD.COMM_CD_ID = CC.COMM_CD_ID
        WHERE
            COMM_CD ='PDT_SELL_STTS_CD'
        ORDER BY
            DTL_CD

    </select>
</mapper>
